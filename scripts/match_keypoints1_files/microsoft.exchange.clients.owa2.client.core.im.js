try { window.scriptsLoaded = window.scriptsLoaded || {}; window.scriptProcessStart = window.scriptProcessStart || {}; window.scriptProcessStart['microsoft.exchange.clients.owa2.client.core.im.js'] = (new Date()).getTime();
Type.registerNamespace("_im");_im.$19t=function(n){_im.$19t.initializeBase(this);this.$A2=n};_im.$19t.prototype={$A2:null,$6NV:function(n){this.$A2.set_$1jn(1);n.$7Pc(this.$A2.get_$jr(),null,this.$$d_$6pk,this.$$d_$1Mo)},$6uq:function(n,t,i){if(n===-9){_js.Trace.logInfo(_a.$0.$6y,"AcceptChatAction.ProcessResult: Suppressing 'ConversationEnded' error.");n=0}if(n<0){i(Error.create("InstantMessageOperationError: "+n));return}this.$A2.set_$1jn(3);_js.Trace.logInfo(_a.$0.$6y,"AcceptChatSession web service call succeeded for chat {0}.",this.$A2.get_$jr());t()},$XH:function(){_a.$Fj.prototype.$XH.call(this)}};_im.$zv=function(n,t){this.$5ZH=n;this.$60F=t};_im.$zv.prototype={$60F:null,$5ZH:null,$3jw:function(n,t){return this.$5ZH.$3jw(n,t)},$4Wp:function(n,t){return this.$5ZH.$4Wp(n,t)},$APi:function(n,t){return new _im.$1PM(n,t)},$7fH:function(n){return this.$60F.$7fH(n)}};_im.$1EQ=function(n,t){_im.$1EQ.initializeBase(this);this.$A2=n;this.$6p=t};_im.$1EQ.prototype={$A2:null,$6p:null,$k8:function(){_a.$Fj.prototype.$k8.call(this);this.$6p.$Dyp(this.$A2)},$6NV:function(n){if(this.$A2.get_$jr()===-1){this.$A2.set_$1jn(4);return}n.$9ot(this.$A2.get_$jr(),null,this.$$d_$6pk,this.$$d_$1Mo)},$6uq:function(n,t,i){this.$A2.set_$1jn(4);if(!n){i(Error.create("EndChatAction returned false."));return}t()}};_im.$1ER=function(n){this.$6p=n};_im.$1ER.prototype={$6p:null,$7fH:function(n){return new _im.$1EQ(n,this.$6p)}};_im.$1H8=function(n){_im.$1H8.initializeBase(this);_a.$4.$1Yw(n,"sipUris");this.$1up=n};_im.$1H8.prototype={$1up:null,$6NV:function(n){n.$8GY(this.$1up,null,this.$$d_$6pk,this.$$d_$1Mo)},$6uq:function(n,t,i){if(n<0){i(Error.create("GetPresenceAction failed with InstantMessageOperationError: "+n));return}t()}};_im.$1JB=function(n){_im.$1JB.initializeBase(this);this.$3IO=n};_im.$1JB.prototype={$3IO:!1,$2YW:!1,$6NV:function(n){n.$8Pb(this.$3IO,null,this.$$d_$6pk,this.$$d_$1Mo)},$6uq:function(n,t,i){if(n<0){if(n!==-2){_js.Trace.logInfo(_a.$0.$6y,"Sign in failed with code {0}, will retry.",n);this.$2YW=!0}i(Error.create("InstantMessageOperationError: "+n));return}t()}};_im.$13T=function(n){_im.$13T.initializeBase(this);this.$3IO=n};_im.$13T.prototype={$3IO:!1,$6NV:function(n){n.$8Pc(this.$3IO,null,this.$$d_$6pk,this.$$d_$1Mo)},$6uq:function(n,t,i){if(n<0){i(Error.create("InstantMessageOperationError: "+n));return}t()}};_im.$1Oo=function(){_im.$1Oo.initializeBase(this)};_im.$1Oo.prototype={$6NV:function(n){n.$3VE(null,this.$$d_$6pk,this.$$d_$1Mo)},$6uq:function(n,t,i){if(n<0){i(Error.create("ResetPresenceAction failed with InstantMessageOperationError: "+n));return}t()}};_im.$1PM=function(n,t){_im.$1PM.initializeBase(this);this.$A2=n;this.$3S=t};_im.$1PM.prototype={$3S:null,$A2:null,$k8:function(){_a.$Fj.prototype.$k8.call(this)},$6NV:function(n){this.$A2.get_$1jn()||this.$A2.set_$1jn(1);var t=new _g.$Zv(this.$3S);t.ChatSessionId=this.$A2.get_$jr();t.Recipients=this.$A2.$Bph();t.Subject=this.$A2.get_$3n();n.$72g(t,null,this.$$d_$6pk,this.$$d_$1Mo)},$6uq:function(n,t,i){if(n<0){i(Error.create("InstantMessageOperationError: "+n));return}this.$A2.set_$jr(n);this.$A2.set_$1jn(3);t()},$XH:function(){$C(this.$2H.message)&&this.$A2.$wt(_nbs.NonBootStrings.l_IMDeliveryError_Text);_a.$Fj.prototype.$XH.call(this)}};_im.$1QA=function(n,t){_im.$1QA.initializeBase(this);_a.$4.$1s(n,"sipUri");this.$Ss=n;this.$462=t};_im.$1QA.prototype={$Ss:null,$462:"None",$6NV:function(n){var t=new _g.$dt;t.Presence=this.$462;n.$7BW(t,null,this.$$d_$6pk,this.$$d_$1Mo)},$6uq:function(n,t,i){var r=n;if(r){i(Error.create("SetPresenceAction failed with InstantMessageOperationError: "+r));return}t()}};_im.$Xw=function(n,t,i,r,u){_im.$Xw.initializeBase(this);_a.$4.$X(i,"participants");_a.$4.$1B3(i.get_$A(),0,"participants.Count");if(!$C(u)){if(i.get_$A()!==1)throw Error.invalidOperation("imAddress can only be used in conjunction with a single participant.");if(!$C(r))throw Error.invalidOperation("imAddress and itemOrConversation are mutually exclusive.");}this.$6p=n;this.$1N0=this.$7fP(i);_a.$4.$1B3(this.$1N0.get_$A(),0,"No valid participants.");this.$2Z5=t;this.$3Jo=r;this.$1TW=u};_im.$Xw.prototype={$6p:null,$2Z5:null,$1N0:null,$3Jo:null,$1TW:null,$k8:function(){_a.$Fj.prototype.$k8.call(this);if(!$C(this.$2Z5)){this.$2Z5.$9mB(this.$1N0,this.$3Jo,this.$1TW);return}this.$6p.$9mB(this.$1N0,this.$3Jo,this.$1TW)},$96z:function(){return 0},$7fP:function(n){for(var u=new _js.$X,f={},e=n.get_$A(),i=0;i<e;i++){var t=n.get_$E(i);if(t&&this.$6p.$1jj(t.get_$DF())){var r=t.get_$DF();if(!(r in f)){u.$F(t);f[r]=t}}}return u}};_im.$18V=function(n,t){this.$6p=n;this.$2Z5=t};_im.$18V.prototype={$6p:null,$2Z5:null,$3jw:function(n,t){return new _im.$Xw(this.$6p,this.$2Z5,n,t,null)},$4Wp:function(n,t){var i=new _js.$X;i.$F(n);return new _im.$Xw(this.$6p,this.$2Z5,i,null,t)}};_im.$1Qx=function(n){_im.$1Qx.initializeBase(this);_a.$4.$1Yw(n,"sipUris");this.$1up=n};_im.$1Qx.prototype={$1up:null,$6NV:function(n){n.$9nH(this.$1up,null,this.$$d_$6pk,this.$$d_$1Mo)},$6uq:function(n,t,i){if(n<0){i(Error.create("SubscribeForPresenceUpdatesAction failed with InstantMessageOperationError: "+n));return}t()}};_im.$1T5=function(n){_im.$1T5.initializeBase(this);_a.$4.$1s(n,"sipUri");this.$Ss=n};_im.$1T5.prototype={$Ss:null,$6NV:function(n){n.$9s5(this.$Ss,null,this.$$d_$6pk,this.$$d_$1Mo)},$6uq:function(n,t,i){if(n<0){i(Error.create("UnsubscribeFromPresenceUpdatesAction failed with InstantMessageOperationError: "+n));return}t()}};_im.$1CB=function(n){this.$61c=n.get_$EnV();this.$iv={}};_im.$1CB.prototype={$61c:0,$iv:null,$F:function(n){this.$7oU();this.$iv[n.toString()]=this.$2ja()},$Hp:function(n){this.$7oU();return n.toString()in this.$iv},$2ja:function(){return _a.$8.get_$36()},$7oU:function(){var s=this.$2ja();var u=new(_ff.$18.$$(String));var f=this.$iv;for(var r in f){var i={key:r,value:f[r]};var h=i.value;var c=h.$1wY(this.$61c);c.$3s(s)<0&&u.$F(i.key)}for(var t=u.$3T(),o=t.length,n=0;n<o;++n){var e=t[n];delete this.$iv[e]}}};_im.$4s=function(n,t,i,r,u,f,e){this.$$d_$9xu=Function.createDelegate(this,this.$9xu);this.$$d_$Dic=Function.createDelegate(this,this.$Dic);this.$$d_$Did=Function.createDelegate(this,this.$Did);this.$$d_$DYe=Function.createDelegate(this,this.$DYe);this.$$d_$EeI=Function.createDelegate(this,this.$EeI);this.$$d_$3v3=Function.createDelegate(this,this.$3v3);this.$$d_$DTM=Function.createDelegate(this,this.$DTM);this.$$d_$Dg0=Function.createDelegate(this,this.$Dg0);this.$$d_$Dg1=Function.createDelegate(this,this.$Dg1);this.$$d_$Di5=Function.createDelegate(this,this.$Di5);this.$$d_$Di6=Function.createDelegate(this,this.$Di6);this.$$d_$9BZ=Function.createDelegate(this,this.$9BZ);this.$$d_$9Ba=Function.createDelegate(this,this.$9Ba);this.$$d_$DOk=Function.createDelegate(this,this.$DOk);this.$$d_$5DY=Function.createDelegate(this,this.$5DY);this.$$d_$9nT=Function.createDelegate(this,this.$9nT);this.$1Zi=new _js.$X;this.$BA=new _js.$X;this.$gq=new _js.$X;_im.$4s.resolveInheritance();this.apcl=this.$p;this.rpcl=this.$1B;_im.$4s.initializeBase(this);this.$nE("Initialization","unknown");this.$Yp=t;this.add_$2UP(this.$Yp.$$d_$9uR);if(!n){this.$nE("Initialization","Disabled");return}this.$n=i;this.$28Q=!0;this.$1g8=!1;this.$4rG=new _im.$1CB(_a.$D5.$Arm(30));var s=new _g.$97;s.NotificationType="InstantMessageNotification";this.$Su=new _h.$D4(s,this.$n,r);this.$Su.add_$3bM(this.$$d_$9nT);if(u&&e){this.$3HE=!0;_js.Trace.logInfo(_a.$0.$6y,"ChatManager: Waiting for the pending-get activation event.");var o=this;u.$1k(_a.$S4,function(n){_js.Trace.logInfo(_a.$0.$6y,"ChatManager: Pending-get activated.");o.$1WH=!0;o.$5YR()});var h=this;u.$1k(_a.$o5,function(){h.$7PZ()});u.$1k(_a.$Ls,this.$$d_$5DY);f?this.$3e(f):this.$Wf="Disabled"}this.$1Zi.add_$21(this.$$d_$DOk);this.$3TK=this.$AOk(this.$n)};_im.$4s.$9qw=function(n,t,i){var r;var f,u;if(u=n.$3cp(function(n){return n.get_$jr()===t},f={val:r}),r=f.val,u){i.val=r;return!0}i.val=null;return!1};_im.$4s.$Eok=function(n,t,i){var r;var f,u;var e=(u=n.$3cp(function(n){var i=n;if(i.get_$g0().get_$A()!==1)return!1;var r=i.get_$g0().get_$E(0);return r.get_$DF()===t?!0:!1},f={val:r}),r=f.val,u);i.val=r;return e};_im.$4s.prototype={$Yp:null,$3HE:!1,$3kV:null,$1yS:null,$1WH:!1,$2FA:!1,$6Og:!1,$4rG:null,$n:null,$4Cv:!1,$28Q:!1,$2xu:!1,$Wf:"unknown",$2Yq:null,$1g8:!1,$Su:null,$3TK:null,add_$2UP:function(n){this.$31(_im.$4s.$27Z,n)},remove_$2UP:function(n){this.$5d(_im.$4s.$27Z,n)},get_$4HP:function(){return this.$Wf},get_$vG:function(){return this.$Wf==="SignedIn"},get_$2r:function(){this.$4R3("IsEnabled");return this.$Wf!=="Disabled"},get_$9yQ:function(){return this.$1Zi},get_$3vB:function(){return this.$BA},get_$5nQ:function(){return this.$gq},get_$C80:function(){return this.$6Og},get_$2Fw:function(){this.$4R3("CurrentUserSipUri");return this.$1yS},$5YP:function(n){if(!this.$1WH){_js.Trace.logInfo(_a.$0.$6y,"Ignoring a SignIn attempt because the pending-get connection is not yet started.");return}this.$28Q=!0;this.$1g8=n;this.$3v3()},$5YT:function(n){_js.Trace.logInfo(_a.$0.$6y,"Signing out.");var t=new _im.$13T(n);t.add_$2s(this.$$d_$9Ba);t.add_$2b(this.$$d_$9BZ);this.$nE("SignOut:Manual="+n,"AttemptingSignOut");this.$n.$1U(t)},$2bB:function(n,t,i){var f=_im.$4h.$fA(t);var e;var r,u;var o=(u=this.$Yp.$5d0(f,r={val:e}),e=r.val,u);this.$62Z(n,f,_im.$4h.$2L1(i),o)},$Eit:function(n,t){var i=new _im.$1QA(_im.$4h.$fA(n),t);i.add_$2s(this.$$d_$Di6);i.add_$2b(this.$$d_$Di5);this.$n.$1U(i)},$nE:function(n,t){t==="Error";_js.Trace.logInfo(_a.$0.$6y,"SignInState: {0} Requesting change from {1} to {2}",n,this.$Wf,t);var i=this.get_$vG();if(this.$Wf!==t){this.$Wf=t;this.$4(_im.$4s.$2Ys);this.get_$vG()!==i&&this.$4(_im.$4s.$4xj)}},$7Li:function(n,t){_js.Trace.logInfo(_a.$0.$6y,"Setting current user SIP URI to {0}",t);this.$1yS=t},$3VE:function(){if(this.$Wf==="SignedIn"){_js.Trace.logInfo(_a.$0.$6y,"ResetPresence");var n=new _im.$1Oo;n.add_$2s(this.$$d_$Dg1);n.add_$2b(this.$$d_$Dg0);this.$n.$1U(n)}},$9mB:function(n,t,i){_js.Trace.logInfo(_a.$0.$6y,"Starting chat.");_a.$4.$z(n,"basePersonaParticipants");_a.$4.$1B3(n.get_$A(),0,"basePersonaParticipants.Count");$C(i)||_a.$4.$S0(n.get_$A(),1,"When imAddress is specified, participant count must be 1.");for(var u=new _js.$X,w=n.get_$A(),o=0;o<w;o++){var y=n.get_$E(o);var p=_pc.$q.$2FV(y);u.$F(p)}var r=null;if(u.get_$A()===1){var e=u.get_$E(0);var f=null;$C(i)?$C(e.get_$DF())||(f=e.get_$DF()):f=i;if(!$C(f)){var h,s;s=_im.$4s.$Eok(this.$1Zi,f,h={val:r}),r=h.val,s}var c=e.get_$29();if(!_js.$9.$1g(f)&&!_js.$9.$1g(c)){var v=_im.$4h.$fA(f);this.$Yp.$2W("StartChat (single participant)",v,c,e.$Hf,!0)}}else{var l=this;u.$Cj(function(n){var t=n;var r=t.get_$DF();var i=t.get_$29();if(!_js.$9.$1g(r)&&!_js.$9.$1g(i)){var u=_im.$4h.$fA(r);l.$Yp.$2W("StartChat (multiple participants)",u,i,t.$Hf,!0)}})}if(!r){r=this.$7eq(u,t);this.$7Po(r);if(!$C(i)){var a=u.get_$E(0);r.$EUR(a,i)}}_g.$11.isInstanceOfType(t)?r.set_$8aY(t):_g.$6V.isInstanceOfType(t)&&r.set_$8aU(t);return r},$3ep:function(n){_js.Trace.logInfo(_a.$0.$6y,"Accepting invitation.");this.$BA.$3K(n);this.$7Po(n);var t=new _im.$19t(n);this.$n.$1U(t)},$3uC:function(n){_js.Trace.logInfo(_a.$0.$6y,"Ignoring invitation.");this.$BA.$3K(n);this.$4rG.$F(n.get_$jr())},$9xz:function(n){_js.Trace.logInfo(_a.$0.$1Pn,"Accepting buddy request {0} ",n.get_$2Z());var u=this.$gq.$3K(n);var r=this.$4nA(n);var t=new _g.$W5;t.GroupType="OtherContacts";var i=new _c.$19s(r,t);this.$n.$1U(i)},$ASH:function(n){_js.Trace.logInfo(_a.$0.$1Pn,"Ignoring buddy request {0} ",n.get_$2Z());this.$gq.$3K(n);var i=this.$4nA(n);var t=new _c.$1DS(i);this.$n.$1U(t)},$Dyp:function(n){_js.Trace.logInfo(_a.$0.$6y,"Removing chat {0}",n.get_$jr());n.set_$1jn(4);n.get_$g0().remove_$21(this.$$d_$DTM);var i=this.$1Zi.$3K(n);var t=this.$BA.$3K(n);$C(n.get_$2P())||_h.$o.get_$Q().$sb(n.get_$2P().Id)},$DYe:function(n){if(n.EventType==="Reload"){_js.Trace.logWarning(_a.$0.$6y,"ChatManager.OnIMNotification: Received a 'Reload' notification from the OWA server, assuming server has rebooted or connection re-established");this.$28Q=!0;this.$3ZX(!1);return}var t=n;var i=t.PayloadType;if($C(i)){_js.Trace.logWarning(_a.$0.$6y,"ChatManager.OnIMNotification: Unexpected notification payload: {0}, {1}",n.EventType,n.toString());return}if(i==="ServiceUnavailable"){if(t.ServiceError==="ClientSignOut"){_js.Trace.logWarning(_a.$0.$6y,"ChatManager.OnIMNotification: Service unavailable, client signed out.  {0}",t.ErrorMessage);this.$nE("IMNotification","SignedOut");return}_js.Trace.logWarning(_a.$0.$6y,"ChatManager.OnIMNotification: Received a 'ServiceUnavailable' notification: {0}, {1}.",t.ServiceError,t.ErrorMessage);this.$3ZX(!1);return}if(i==="SignOn")if(t.SignOnStarted){_js.Trace.logInfo(_a.$0.$6y,"ChatManager.OnIMNotification: Sign-on started.");return}else{_js.Trace.logInfo(_a.$0.$6y,"ChatManager.OnIMNotification: Sign-on succeeded.");this.$3ZX(!0);this.$6pO();this.$6Og=t.IsUserInUcsMode;return}if(i==="UpdateUserPresence"||i==="UserPresenceChange"||i==="QueryUserPresenceChange"){this.$ApX(t);return}this.$Yp.$7LW(t);!$C(t.Persona)&&$C(t.Persona.ImAddress)&&(t.Persona.ImAddress=t.SipUri);if(t.PayloadType==="PendingContactList"){if($C(t.PendingContacts)){_js.Trace.logWarning(_a.$0.$1Pn,"The payload for PendingContacts is empty");return}this.$AKG(t.PendingContacts);return}if(t.PayloadType==="AddToBuddyList"){if($C(t.AddedContacts)){_js.Trace.logWarning(_a.$0.$1Pn,"The payload for AddedContacts is empty");return}this.$Dym(t.AddedContacts)&&_js.Trace.logInfo(_a.$0.$1Pn,"Removed already added contact from pending buddyRequests");return}if(t.PayloadType==="EmptySubscribers"){this.$AkY();_js.Trace.logInfo(_a.$0.$1Pn,"Removed already added contact from pending buddyRequests after receiving emptysubscribers");return}if(!("ChatSessionId"in t)){_js.Trace.logInfo(_a.$0.$6y,"Notification {0} not supported, no session id.",i);return}if(this.$4rG.$Hp(t.ChatSessionId)){_js.Trace.logInfo(_a.$0.$6y,"ChatManager.OnIMNotification: {0} for conversation {1} was ignored.",t.PayloadType,t.ChatSessionId);return}_js.Trace.logInfo(_a.$0.$6y,"ChatManager.OnIMNotification: {0}, Session={1}, SipUri={2}",i,t.ChatSessionId,t.SipUri);var r;var e,o,u,f;if((o=_im.$4s.$9qw(this.$1Zi,t.ChatSessionId,e={val:r}),r=e.val,o)||(f=_im.$4s.$9qw(this.$BA,t.ChatSessionId,u={val:r}),r=u.val,f)){var s=this.$Yp.$3EK(t.SipUri,t.DisplayName);this.$DsV(t,r,s);return}_js.Trace.logInfo(_a.$0.$6y,"No matching chat found for session {0}",t.ChatSessionId);this.$Ep8(t)},$4U0:function(n){for(var r=n.get_$A(),t=0;t<r;t++){var i=n.get_$E(t);if(i&&this.$1jj(i.SipUri))return!0}return!1},$1jj:function(n){return _js.$9.$1g(n)?!1:_js.$9.$1g(this.get_$2Fw())?!1:n.toLowerCase()===this.get_$2Fw().toLowerCase()?!1:!0},$2L1:function(n){return _im.$4h.$2L1(n)},$6Hy:function(n){return _im.$4h.$6Hy(n)},$AOk:function(n){return new _im.$1Nx(n)},$ASr:function(){this.$nE("DelayInternalSignIn","AttemptingSignIn");_js.$D.get_$Q().$2V(_a.$0.$6y,"ChatManager.InternalSignIn",this.$$d_$3v3,3e4)},$2A:function(){this.remove_$2UP(this.$Yp.$$d_$9uR);_js.$Eb.prototype.$2A.call(this)},$Did:function(n){_js.Trace.logInfo(_a.$0.$6y,"Sign-in action succeeded.  Awaiting notification.");this.$2Yq=_js.$D.get_$Q().$2V(_a.$0.$6y,"ChatManager.SignInNotificationTimeout",this.$$d_$EeI,1e4)},$Dic:function(n){_js.Trace.logInfo(_a.$0.$6y,"Sign-in action failed.");var t=n;if(t.get_$4d()===-11){_js.Trace.logInfo(_a.$0.$6y,"Automatic sign-in rejected because the user was explicitly signed out.");this.$nE("Automatic Sign-In Rejected","SignedOut");return}_js.Trace.logWarning(_a.$0.$6y,"Sign-in failed: {0}",t.$2H.message);this.$3ZX(!1)},$EeI:function(){_js.Trace.logWarning(_a.$0.$6y,"Sign-in timeout expired.  Current sign-in state: {0}, ServiceAvailable: {1}.",this.$Wf,this.$4Cv);this.$Wf!=="SignedIn"&&this.$3ZX(!1)},$9Ba:function(n){_js.Trace.logInfo(_a.$0.$6y,"Sign-out succeeded.");this.$nE("SignOutSucceeded","SignedOut")},$9nT:function(n,t){if(!this.$2xu){_js.Trace.logInfo(_a.$0.$6y,"Subscribed to notifications.");this.$2xu=!0;this.$3v3()}},$8QN:function(n,t,i){if(this.$Wf!=="Disabled"){var r=n?"SignedOut":"Disabled";if(_js.$9.$o(i)){_js.Trace.logInfo(_a.$0.$6y,"The currentUserSipUri is null/empty -> Marking SignInState as disabled.");r="Disabled"}else i=_im.$4h.$fA(i);this.$nE("Configuration Updated",r)}this.$3kV=t;this.$7Li("InternalSetConfiguration",i);this.$2FA=!0},$3v3:function(){if(!this.$2xu){_js.Trace.logInfo(_a.$0.$6y,"Subscribing to notifications.");this.$Su.$1k(_a.$0.$6y,"OnIMNotification",this.$$d_$DYe,1);return}_js.Trace.logInfo(_a.$0.$6y,"Signing in. Manual: {0}, will retry: {1}",this.$1g8,this.$28Q);var n=new _im.$1JB(this.$1g8);n.add_$2s(this.$$d_$Did);n.add_$2b(this.$$d_$Dic);this.$nE("InternalSignIn","AttemptingSignIn");this.$n.$1U(n);this.$2Yq&&(this.$2Yq=_js.$D.get_$Q().$6Q(this.$2Yq))},$4nA:function(n){var t=new _g.$W4;_a.$4.$z(n,"persona");t.DisplayName=n.get_$29();t.SipUri=n.get_$DF();return t},$7eq:function(n,t){_js.Trace.logInfo(_a.$0.$6y,"Creating new Chat.");var i=new _h.$1g(!0);i.get_$g0().add_$21(this.$$d_$DTM);i.get_$g0().$1y6(n);i.set_$2P(new _g.$1T("IM:"+Math.random().toString()));if(!t)return i;if(_g.$11.isInstanceOfType(t)){i.set_$8aY(t);return i}if(_g.$6V.isInstanceOfType(t)){i.set_$8aU(t);return i}var r=_js.$9.$5M("CreateChat: itemOrConversation type {0} is not supported.",Object.getType(t).getName());_js.Trace.logError(_a.$0.$6y,r);throw Error.invalidOperation(r);},$7Po:function(n){_js.Trace.logInfo(_a.$0.$6y,"Activating chat.");$C(n.get_$2P())||_h.$o.get_$Q().$JU(n.get_$2P().Id,n);var t=this.$Bmy(n);this.$1Zi.$76(t,n)},$DsV:function(n,t,i){var u=n.PayloadType;switch(u){case"NewChatMessageToast":_js.Trace.logInfo(_a.$0.$6y,"NewChatMessageToast received and mapped to chat {0}.",t.get_$jr());return;case"ParticipantJoined":this.$Yp.$7SE(n);var r;if($C(n.Persona))r=_pc.$q.$4X9(i,n.SipUri);else{r=new _pc.$q;r.$KD(n.Persona)}t.$DnM(n.SipUri,r,i);return;case"ParticipantLeft":t.$DnN(n.SipUri,i);return;case"EndChatSession":t.$6Jl||this.$BA.$3K(t);return;case"NewChatMessage":t.$99W(i,n.MessageContent);return;case"UserActivity":switch(n.UserActivity){case"FailedDelivery":t.$wt(_nbs.NonBootStrings.l_IMDeliveryError_Text);return;case"Typing":t.$Edx(i);return;case"StoppedTyping":t.set_$GX("");return;case"TwoOrMoreTyping":t.set_$GX(_nbs.NonBootStrings.l_IMActivityMultipleUsersTyping_Text);return;case"DeliveryTimeout":t.$wt(_nbs.NonBootStrings.l_IMDeliveryTimeout_Text);return;default:return}}},$Ep8:function(n){if(n.PayloadType==="NewChatMessageToast"){this.$Yp.$7SE(n);var r=this.$Yp.$3EK(n.SipUri,n.DisplayName);var u=this.$7g3(n.Persona,r,n.SipUri,n.ToastMessage,n.MessageSubject,n.ChatSessionId);_js.Trace.logInfo(_a.$0.$6y,"ChatManager.TryProcessInvitation: Created invitation for conversation {0} (NewChatMessageToast).",n.ChatSessionId);return!0}if(n.PayloadType==="NewChatMessage"){var t=this.$Yp.$3EK(n.SipUri,n.DisplayName);var i=this.$7g3(n.Persona,t,n.SipUri,n.MessageContent,"",n.ChatSessionId);i.$99W(t,n.MessageContent);_js.Trace.logInfo(_a.$0.$6y,"ChatManager.TryProcessInvitation: Created invitation for conversation {0} (NewChatMessage).",n.ChatSessionId);return!0}return!1},$7g3:function(n,t,i,r,u,f){var o;if($C(n))o=_pc.$q.$4X9(t,i);else{o=new _pc.$q;o.$KD(n)}$C(r)&&(r="");var s=new _js.$X;s.$F(o);var e=this.$7eq(s,null);e.set_$jr(f);e.$2aE=o;e.$3cJ=r;_js.$9.$1g(u)||e.set_$3n(u);this.$BA.$F(e);return e},$AKG:function(n){_a.$4.$z(n,"senderInfo");for(var u=n,e=u.length,r=0;r<e;++r){var t=u[r];var i=t.SipUri;_js.Trace.logInfo(_a.$0.$1Pn,"Adding pending contact to buddy requests list",i);var f=this.$3EL(t.DisplayName,t.Title,i);this.$8So(i,!1)||this.$gq.$F(f)}},$Dym:function(n){_a.$4.$z(n,"senderInfo");for(var r=!1,u=n,f=u.length,t=0;t<f;++t){var e=u[t];var i=e.SipUri;_js.Trace.logInfo(_a.$0.$1Pn,"Examining the AddToBuddyList payload for existing buddy requests",i);r=this.$8So(i,!0)}return r},$AkY:function(){_js.Trace.logInfo(_a.$0.$1Pn,"Received empty subscribers notification, we need to hide the pending buddy dialogue");this.$gq.$1u()},$3EL:function(n,t,i){_a.$4.$z(n,"displayName");_a.$4.$z(i,"buddyImAddress");var r=_pc.$q.$4X9(n,i);_js.$9.$o(t)||r.set_$3u(t);return r},$8So:function(n,t){for(var i=0;i<this.$gq.get_$A();i++){var r=this.$gq.get_$E(i);if(!r.get_$DF().localeCompare(n)){if(t){_js.Trace.logInfo(_a.$0.$1Pn,"Removing already added contact from pending buddyRequests",r.get_$DF());this.$gq.$5W(i)}return!0}}return!1},$Bmy:function(n){var t=this;return this.$1Zi.$HC(function(t){return n.$3zR.$3s(t.$3zR)>=0})},$3ZX:function(n){this.$2Yq&&(this.$2Yq=_js.$D.get_$Q().$6Q(this.$2Yq));var t=this.$4Cv;this.$4Cv=n;if(n&&t){_js.Trace.logInfo(_a.$0.$6y,"Service confirmed available.");return}else if(n&&!t){_js.Trace.logInfo(_a.$0.$6y,"Service resumed.");return}else if(!n&&t){_js.Trace.logInfo(_a.$0.$6y,"Service interrupted.");this.$7PZ();this.$9OH();return}else if(!n&&!t){_js.Trace.logInfo(_a.$0.$6y,"Service confirmed unavailable.");this.$9OH();return}_js.Trace.logError(_a.$0.$6y,"Unexpected condition in ChatManager.SetServiceAvailability.")},$6pO:function(){this.$nE("SignedOn Succeeded","SignedIn");this.$28Q=!0;this.$1g8=!1},$7PZ:function(){this.$1Zi.$Cj(this.$$d_$9xu);this.$BA.$Cj(this.$$d_$9xu);var n=this;this.$1Zi.$Cj(function(t){t.$Ede(n.$4Cv)})},$9OH:function(){if(this.$Wf==="AttemptingSignIn"||this.$Wf==="SignedIn"||this.$Wf==="Error"){if(this.$28Q){this.$28Q=!1;this.$ASr();return}this.$1g8=!1;this.$nE("SignIn-GiveUp","Error")}},$9BZ:function(n){_js.Trace.logWarning(_a.$0.$6y,"Sign-out failed: {0}",n.$2H.message);this.$nE("SignOutFailed","SignedOut")},$Dg1:function(n){_js.Trace.logInfo(_a.$0.$6y,"Reset presence succeeded.")},$Dg0:function(n){_js.Trace.logWarning(_a.$0.$6y,"Reset presence failed: {1}",n.$2H.message)},$Di6:function(n){var t=n;_js.Trace.logInfo(_a.$0.$6y,"Set presence to {0} succeeded.",t.$462)},$Di5:function(n){var t=n;_js.Trace.logWarning(_a.$0.$6y,"Set presence to {0} failed: {1}",t.$462,n.$2H.message)},$9xu:function(n){var t=n;t.set_$jr(-2);t.$Edf()},$62Z:function(n,t,i,r){var f=this.$Yp.$3EK(t,null);var e=new _im.$oe(n,t,f,i,r);var u=this.$ut(_im.$4s.$27Z);u&&u(e)},$ApX:function(n){var u=this.$ut(_im.$4s.$27Z);if(u){var e=n.PayloadType;if(n.PayloadType==="UpdateUserPresence"){var r=n.DisplayName;_js.$9.$1g(r)&&(r=this.$3kV);var s=new _im.$oe(e,this.$1yS,r,_im.$4h.$2L1(n.NewUserPresence),!0);u(s);return}if(!$C(n.UserPresenceChanges))for(var h=n.PayloadType!=="QueryUserPresenceChange",f=n.UserPresenceChanges,c=f.length,i=0;i<c;++i){var t=f[i];var o=new _im.$oe(e,t.SipUri,t.UserName,_im.$4h.$2L1(t.Presence),h);u(o)}}},$DTM:function(n,t){switch(t.$3P){case 0:var f=t.$4C;var e=this.$8Bi(f);this.$3TK.$7T6(e);break;case 2:var u=t.$4W;var i=this.$8Bi(u);var r=this.$7p7(i);this.$3TK.$2VJ(r);break;case 1:case 3:default:_a.$4.$FX(!1,"Unexpected notification received: "+t.$3P);break}},$8Bi:function(n){var r=new(_ff.$18.$$(String));if(n)for(var i=n,f=i.length,t=0;t<f;++t){var u=i[t];this.$7S7(r,u)}return r},$7p7:function(n){for(var f=this.$6EV(this.$1Zi.$3T()),u=new(_ff.$18.$$(String)),r=n.get_$1z(),e=r.length,t=0;t<e;++t){var i=r[t];f.$5o(i)||u.$F(i)}return u},$DOk:function(n,t){switch(t.$3P){case 0:var f=t.$4C;var e=this.$6EV(f);this.$3TK.$7T6(e);break;case 2:var u=t.$4W;var i=this.$6EV(u);var r=this.$7p7(i);this.$3TK.$2VJ(r);break;case 1:case 3:default:_a.$4.$FX(!1,"Unexpected notification received: "+t.$3P);break}},$6EV:function(n){var r=new(_ff.$18.$$(String));if(n)for(var u=n,e=u.length,t=0;t<e;++t){var o=u[t];var i=o;if(i.get_$g0()){var f=this;i.get_$g0().$Cj(function(n){f.$7S7(r,n)})}}return r},$7S7:function(n,t){var r=t;var i=_im.$4h.$fA(r.get_$DF());i.localeCompare(this.$1yS)&&(n.$5o(i)||n.$F(i))},$4R3:function(n){this.$3HE&&(this.$Wf==="unknown"||!this.$2FA)&&_js.Trace.logError(_a.$0.$6y,"ChatManager: Do not access {0} until configuration has loaded.",n)},$5YR:function(){if(this.get_$2r()&&this.$1WH&&this.$2FA){var n=this;_js.$D.get_$Q().$2V(_a.$0.$6y,"ChatManager.SignIn",function(){n.$5YP(!1)},5e3)}},$3e:function(n){var r=n.get_$9K().get_$3uy();var i=n.get_$4X().get_$Lh();var t=n.get_$4X().get_$1vv();this.$8QN(r,i,t);this.$5YR()},$5DY:function(n){if(!n.$1QP){this.$28Q=!1;this.$3ZX(!1)}}};_im.$zw=function(n,t,i,r,u,f,e){this.$43=n;this.$Yp=t;this.$n=i;this.$2xr=r;this.$N=u;this.$d=f;this.$1oU=e};_im.$zw.prototype={$43:!1,$Yp:null,$n:null,$2xr:null,$N:null,$d:null,$1oU:!1,$6p:null,$9:function(){this.$6p||(this.$6p=new _im.$4s(this.$43,this.$Yp,this.$n,this.$2xr,this.$N,this.$d.get_$1Z(),this.$1oU));return this.$6p}};_im.$Ll=function(){this.$$d_$9uR=Function.createDelegate(this,this.$9uR);_im.$Ll.initializeBase(this);this.$Fw={}};_im.$Ll.prototype={$Fw:null,$3VE:function(){var t=this.$Fw;for(var n in t){var r={key:n,value:t[n]};var i=r.value;i.set_$I1(0)}},$7LW:function(n){this.$9uQ(n,!1)},$7SE:function(n){this.$9uQ(n,!0)},$9uR:function(n){this.$2W(n.$2i,n.$Ss,n.$6r,n.$Hf,n.$2N1)},$2W:function(n,t,i,r,u){this.$5e3(n,t,i,u);this.$2bB(n,t,r,u)},$3EK:function(n,t){var i=t;if(_js.$9.$1g(i)&&!_js.$9.$1g(n)){n=_im.$4h.$fA(n);var r=this.$Fw[n];$C(r)||(i=r.$6r);_js.$9.$1g(i)&&(i=_im.$4h.$yu(n))}return i},$5d0:function(n,t){t.val=0;n=_im.$4h.$fA(n);var i=this.$Fw[n];if($C(i))return!1;t.val=i.$Hf;return!0},$9uQ:function(n,t){if(!_js.$9.$1g(n.SipUri)){this.$5e3(n.PayloadType,n.SipUri,n.DisplayName,t);if(!$C(n.NewUserPresence)){var i=_im.$4h.$2L1(n.NewUserPresence);this.$2bB(n.PayloadType,n.SipUri,i,t)}}},$5e3:function(n,t,i,r){var u=this;this.$5eN(n,t,r,function(n){_js.$9.$1g(i)||n.set_$29(i)})},$2bB:function(n,t,i,r){var u=this;this.$5eN(n,t,r,function(n){$C(i)||n.set_$I1(i)})},$5eN:function(n,t,i,r){t=_im.$4h.$fA(t);var u=this.$Fw[t];if($C(u)){if(!i)return;u=new _im.$zx(t);this.$Fw[t]=u}r(u)}};_im.$zx=function(n){_im.$zx.initializeBase(this);_a.$4.$1s(n,"sipUri");this.$Ss=n};_im.$zx.prototype={$Ss:null,$6r:null,$Hf:0,set_$29:function(n){if(this.$6r===n)return n;this.$6r=n;this.$4("DisplayName");return n},set_$I1:function(n){if(this.$Hf===n)return n;this.$Hf=n;this.$4("Presence");return n},toString:function(){return String.format("SipUri: {0}, DisplayName: {1}, Presence: {2}",this.$Ss,$C(this.$6r)?"":this.$6r,this.$Hf)}};_im.$zy=function(n,t,i,r){this.$$d_$DaT=Function.createDelegate(this,this.$DaT);this.$hY=n;this.$6p=t;this.$14Y=i;this.$11k=r;this.$14Y.add_$19f(this.$$d_$DaT);this.$11k.add_$19f(this.$$d_$DaT)};_im.$zy.prototype={$6p:null,$14Y:null,$11k:null,$hY:!1,$6s:null,$2lZ:!1,$6Vo:0,add_$w7:function(n){if(n&&this.$hY){if(this.get_$G6()){n();return}this.$6s||(this.$6s=new Sys.EventHandlerList);this.$6s.addHandler("chatInitialized",n)}},get_$Gx:function(){return this.get_$G6()&&this.$hY?this.$6p:null},get_$27Y:function(){return this.get_$G6()&&this.$hY?this.$14Y.get_$1Z():null},get_$1Q6:function(){return this.get_$G6()&&this.$hY?this.$11k.get_$1Z():null},get_$rt:function(){return this.$hY},get_$G6:function(){if(!this.$2lZ&&this.$hY){this.$14Y.$9(null);this.$11k.$9(null)}return this.$2lZ||!this.$hY},$DaT:function(){this.$6Vo++;if(this.$6Vo===2){this.$2lZ=!0;if(this.$6s){this.$6s.getHandler("chatInitialized")();this.$6s=null}}}};_im.$zz=function(n,t,i,r,u){this.$hY=n;this.$6p=t;this.$14Y=i;this.$11k=r;this.$BQ=u};_im.$zz.prototype={$hY:!1,$6p:null,$14Y:null,$11k:null,$BQ:0,$1Q:null,$9:function(){_a.$4.$S0(this.$BQ,"Mouse","ChatProviderFactory.Create - Layout");this.$1Q||(this.$1Q=new _im.$zy(this.$hY,this.$6p,this.$14Y,this.$11k));return this.$1Q}};_im.$16d=function(n,t,i){_im.$16d.initializeBase(this,[n,t,i]);_js.Trace.logInfo(_a.$0.$6y,"PopOutPresenceManager.Ctor.")};_im.$16d.prototype={get_isPopout:function(){return!0},$AOj:function(){return new _im.$1Nn(this.$1WY)},$5Eg:function(n){this.$7Kf(n.$Ss,n.$Hf)},$7MB:function(n){this.$2VY.$7SF(n)},$EvG:function(){}};_im.$1Nn=function(n){_im.$1Nn.initializeBase(this,[n]);_js.Trace.logInfo(_a.$0.$6y,"PopOutPresenceRequestsManager.Ctor")};_im.$1Nn.prototype={$7SF:function(n){_a.$4.$1s(n,"sipUri");this.$1WY.queryPresenceInMainWindow(n)},$E06:function(n){_a.$4.$1s(n,"sipUri");return!0},$AEj:function(){}};_im.$od=function(n,t,i){this.$$d_$983=Function.createDelegate(this,this.$983);this.$$d_$5Eg=Function.createDelegate(this,this.$5Eg);this.$$d_$9BY=Function.createDelegate(this,this.$9BY);this.$b3={};_im.$od.initializeBase(this);_a.$4.$X(n,"chatManager");_a.$4.$X(t,"chatParticipantCache");_a.$4.$X(i,"presenceCrossWindowNotifier");this.$6p=n;this.$Fw=t;this.$6p.$p(_im.$4s.$2Ys,this.$$d_$9BY);this.$6p.add_$2UP(this.$$d_$5Eg);this.$1WY=i;this.$2VY=this.$AOj();this.$2n4=this.$6p.$Wf;_js.Trace.logInfo(_a.$0.$I1,"PresenceManager.Ctor.")};_im.$od.prototype={$6p:null,$Fw:null,$1WY:null,$2VY:null,$2n4:"unknown",get_$vG:function(){return this.$6p.$Wf==="SignedIn"},$7KZ:function(n){_a.$4.$X(n,"persona");if(!this.$6p.get_$2r())return!1;_js.Trace.logInfo(_a.$0.$I1,"PresenceManager.TryRegisterForPresenceUpdates: Registering persona for presence updates: {0}, SIP:{1}",n.get_$B6(),n.get_$DF()||"");n.apcl("ImAddress",this.$$d_$983);if(_js.$9.$1g(n.get_$DF()))return!0;var t=_im.$4h.$fA(n.get_$DF());this.$Eur(t,n);this.$7MB(t);return!0},$7Ke:function(n){_a.$4.$X(n,"persona");_js.Trace.logInfo(_a.$0.$I1,"PresenceManager.TryUnregisterForPresenceUpdates: Unregistering persona for presence updates: {0}, SIP:{1}",n.get_$B6(),n.get_$DF()||"");return this.$5d8(n,n.get_$DF())},$DuC:function(n,t){_a.$4.$1s(n,"sipUri");this.$7MB(n);t.val=0;if(n in this.$b3){var i=this.$b3[n];if(i.get_$A()>0){t.val=i.get_$E(0).get_$I1();return!0}}return!1},$AOj:function(){return new _im.$SI(this.$1WY)},$7MB:function(n){if(this.get_$vG()){var t;var r,i;(i=this.$Fw.$5d0(n,r={val:t}),t=r.val,i)&&this.$7Kf(n,t);n!==_im.$4h.$fA(this.$6p.get_$2Fw())&&this.$2VY.$7SF(n)}},$5Eg:function(n){if(this.get_$vG()){this.$7Kf(n.$Ss,n.$Hf);this.$1WY.updatePresenceInAllPopOutWindows(n.$Ss,n.$Hf)}},$7Kf:function(n,t){n=_im.$4h.$fA(n);if(!(n in this.$b3))return!1;for(var r=this.$b3[n],i=0;i<r.get_$A();i++){var u=r.get_$E(i);u.set_$I1(t)}return!0},$EvG:function(){this.$1WY.updateSignInStateInAllPopOutWindows(this.$2n4)},$2A:function(){_js.Trace.logInfo(_a.$0.$I1,"PresenceManager.InternalDispose.");this.$6p.$1B(_im.$4s.$2Ys,this.$$d_$9BY);this.$6p.remove_$2UP(this.$$d_$5Eg);this.$2VY.$1v();this.$2VY=null},$5d8:function(n,t){if(!this.$6p.get_$2r())return!1;n.rpcl("ImAddress",this.$$d_$983);if(_js.$9.$1g(t))return!1;var i=_im.$4h.$fA(t);if(!(i in this.$b3))return!1;var r=this.$b3[i];var u=r.$3K(n);if(!r.get_$A()){delete this.$b3[i];this.$2VY.$E06(i)}return u},$9BY:function(n,t){var a=n;var r=this.$2n4;var y=r==="SignedIn";this.$2n4=a.$Wf;var s=this.get_$vG();if(y!==s)if(s){_js.Trace.logInfo(_a.$0.$I1,"PresenceManager.OnSignInStateChanged: OldSignInState: {0} to NewSignInState: {1}. Requesting presence for every persona active.",r,this.$2n4);var e=this.$b3;for(var f in e){var c={key:f,value:e[f]};var l=c.key;this.$7MB(l)}}else{_js.Trace.logInfo(_a.$0.$I1,"PresenceManager.OnSignInStateChanged: OldSignInState: {0} to NewSignInState: {1}. Resetting presence to Unknown everywhere.",r,this.$2n4);var h=this.$b3;for(var o in h)for(var v={key:o,value:h[o]},u=v.value,i=0;i<u.get_$A();i++)u.get_$E(i).set_$I1(0);this.$2VY.$AEj();this.$Fw.$3VE()}this.$EvG()},$983:function(n,t){var i=n;var r=null;var e=this.$b3;for(var f in e){var u={key:f,value:e[f]};var s=u.key;var o=u.value;if(o.$5o(i)){r=s;break}}_js.Trace.logInfo(_a.$0.$I1,"PresenceManager.OnImAddressChangedForAPersona: Unregistering persona {0} for old IM Address {1}",i.get_$B6(),r);this.$5d8(i,r);_js.Trace.logInfo(_a.$0.$I1,"PresenceManager.OnImAddressChangedForAPersona: Re-registering persona {0} for new IM Address {1}",i.get_$B6(),$C(i.get_$DF())?"":i.get_$DF());this.$7KZ(i)},$Eur:function(n,t){n in this.$b3||(this.$b3[n]=new(_a.$u.$$(_bc.$mQ)));var i=this.$b3[n];if(!i.$5o(t)){i.$F(t);i.get_$A()>1?t.set_$I1(i.get_$E(0).get_$I1()):this.get_$vG()||t.set_$I1(0)}}};_im.$SI=function(n){this.$$d_$Djs=Function.createDelegate(this,this.$Djs);this.$$d_$DXN=Function.createDelegate(this,this.$DXN);this.$$d_$DdD=Function.createDelegate(this,this.$DdD);this.$1N3=new(_a.$u.$$(String));_im.$SI.initializeBase(this);_a.$4.$z(n,"presenceCrossWindowNotifier");this.$1WY=n;this.$1N3.add_$21(this.$$d_$DdD);_js.Trace.logInfo(_a.$0.$I1,"PresenceRequestsManager.Ctor")};_im.$SI.prototype={$1WY:null,$2db:null,$7SF:function(n){_a.$4.$1s(n,"sipUri");if(!this.$1N3.$5o(n)){_js.Trace.logInfo(_a.$0.$I1,"PresenceRequestsManager.AddOrUpdatePendingGetRequests: Queuing a presence retrieval request for sip {0}",n);this.$1N3.$F(n)}},$E06:function(n){_a.$4.$1s(n,"sipUri");return this.$1N3.$3K(n)},$AEj:function(){_js.Trace.logInfo(_a.$0.$I1,"PresenceRequestsManager.ClearAll: Clearing all pending get presence requests: {0}",this.$1N3.get_$A());this.$1N3.$1u()},$2A:function(){_js.Trace.logInfo(_a.$0.$I1,"PresenceRequestsManager.InternalDispose.");this.$7Ym()},$7Ym:function(){if(this.$2db){_js.Trace.logInfo(_a.$0.$I1,"PresenceRequestsManager.CancelBatchGetPresenceRequestsTimer.");this.$2db=_js.$D.get_$Q().$6Q(this.$2db)}},$Djs:function(){this.$2db=null;var t=this.$1N3.$3T();var i=t.join("; ");this.$1N3.$1u();var n=new _im.$1H8(t);n.add_$4T(this.$$d_$DXN);OwaApplication.$2B.$1U(n)},$DdD:function(n,t){if(this.$1N3.get_$A()>0){if(!this.$2db){_js.Trace.logInfo(_a.$0.$I1,"PresenceRequestsManager.OnPendingGetPresenceRequestsCollectionChanged: Activating timer to run after {0}ms. Current count of pending requests = {1}",_im.$SI.$7Is,this.$1N3.get_$A());this.$2db=_js.$D.get_$Q().$2V(_a.$0.$I1,"GetPresence",this.$$d_$Djs,_im.$SI.$7Is)}}else{_js.Trace.logInfo(_a.$0.$I1,"PresenceRequestsManager.OnPendingGetPresenceRequestsCollectionChanged: Cancelling timer. Current count of pending requests = {0}",this.$1N3.get_$A());this.$7Ym()}},$DXN:function(n){var t=n;var i=t.$1up.join("; ");if(t.$2H){_js.Trace.logWarning(_a.$0.$I1,"PresenceRequestsManager.OnGetPresenceActionCompleted: Failed with {0} for {1} SipUris: '{2}'",t.$2H,this.$1N3.get_$A(),i);return}}};_im.$1Nx=function(n){this.$$d_$DkN=Function.createDelegate(this,this.$DkN);this.$$d_$47Z=Function.createDelegate(this,this.$47Z);this.$$d_$DjD=Function.createDelegate(this,this.$DjD);this.$n=n;this.$2aF=new(_ff.$18.$$(String));this.$2cR=new(_ff.$18.$$(String));this.$2Ax=new(_ff.$18.$$(String))};_im.$1Nx.prototype={$n:null,$2aF:null,$2cR:null,$2Ax:null,$4Q3:!1,$7T6:function(n){for(var i=new(_ff.$18.$$(String)),f=n.get_$1z(),e=f.length,r=0;r<e;++r){var t=f[r];if(this.$2Ax.$5o(t)){this.$2Ax.$3K(t);continue}this.$2cR.$5o(t)||this.$2aF.$5o(t)||i.$5o(t)||i.$F(t)}if(i.get_$A()>0){this.$2aF.$3x(i.get_$1z());var u=new _im.$1Qx(i.get_$1z());u.add_$2s(this.$$d_$DjD);u.add_$2b(this.$$d_$47Z);this.$n.$1U(u)}},$2VJ:function(n){for(var i=0;i<n.get_$A();i++){var t=n.get_$E(i);if(this.$2aF.$5o(t)){this.$2aF.$3K(t);continue}this.$2Ax.$5o(t)||this.$2cR.$5o(t)&&this.$2Ax.$F(t)}this.$9mc()},$9mc:function(){if(this.$2Ax.get_$A()&&!this.$4Q3){this.$4Q3=!0;var t=this.$2Ax.get_$E(0);this.$2Ax.$5W(0);this.$2cR.$3K(t);var n=new _im.$1T5(t);n.add_$4T(this.$$d_$DkN);this.$n.$1U(n)}},$DkN:function(n){this.$4Q3=!1;this.$9mc()},$DjD:function(n){for(var f=n,r=f.$1up,u=r.length,t=0;t<u;++t){var i=r[t];this.$2cR.$5o(i)||this.$2cR.$F(i);this.$2aF.$3K(i)}_js.Trace.logInfo(_a.$0.$6y,"SubscribeForPresenceUpdates: succeeded.")},$47Z:function(n){for(var r=n,i=r.$1up,e=i.length,t=0;t<e;++t){var f=i[t];this.$2aF.$3K(f)}var u=r.$1up.join(";");_js.Trace.logInfo(_a.$0.$6y,"SubscribeForPresenceUpdates: failed to subscribe for: {0}.",u)}};_im.$oe=function(n,t,i,r,u){_a.$4.$1s(n,"source");_a.$4.$1s(t,"sipUri");this.$2i=n;this.$Ss=t;this.$6r=i;this.$Hf=r;this.$2N1=u};_im.$oe.prototype={$2i:null,$Ss:null,$6r:null,$Hf:0,$2N1:!1,toString:function(){return String.format("Source: {0}, Sip: {1}, DisplayName: {2}, Presence: {3}, IsAboutMeOrMyBuddy: {4}",this.$2i,this.$Ss,$C(this.$6r)?"":this.$6r,this.$Hf,this.$2N1)}};_im.$4h=function(){};_im.$4h.$2L1=function(n){switch(n){case"Away":return 3;case"BeRightBack":return 3;case"Busy":return 4;case"DoNotDisturb":return 6;case"IdleBusy":return 4;case"IdleOnline":return 2;case"None":return 0;case"Offline":return 1;case"Online":return 2;default:return 0}};_im.$4h.$6Hy=function(n){switch(n){case 2:return"Online";case 3:return"Away";case 5:return"IdleBusy";case 4:return"Busy";case 6:return"DoNotDisturb";case 1:return"Offline";case 0:default:return"None"}};_im.$4h.$fA=function(n){_a.$4.$1s(n,"imAddress");var t=n.toLowerCase();t.startsWith("sip:")||(t="sip:"+t);return t};_im.$4h.$yu=function(n){_a.$4.$1s(n,"imAddress");var t=n.toLowerCase();t.startsWith("sip:")&&(t=t.substr(4));return t};function IMComponent(){}IMComponent.prototype={$2FB:function(n,t,i){var c=this;n.$r(_im.$Ll).$1I().$t(function(){return new _im.$Ll});var h=this;n.$r(_h.$141).$1I().$t(function(){return new _im.$1Qp(n.$2(_y.$Do))});var l=this;n.$r(IChatManagerFactory).$1I().$t(function(){var t=i.get_$A9()==="Mouse"&&!_a.$7Z.$z6();return new _im.$zw(t,n.$2(_im.$Ll),n.$2(_a.$2b),null,n.$2(_ff.$M),n.$WT(_g.$2c),i.get_$Cp())});var v=this;n.$r(_im.$4s).$1I().$t(function(){return n.$2(IChatManagerFactory).$9()});var a=this;n.$r(IChatActionFactory).$1I().$t(function(){var t;t=i.get_$1oV()?new _im.$18V(n.$2(_im.$4s),n.$2(_h.$141)):new _im.$18V(n.$2(_im.$4s),null);return new _im.$zv(t,new _im.$1ER(n.$2(_im.$4s)))});var s=this;n.$r(_im.$rr).$2a(IChatViewModelFactory).$t(function(){return new _im.$rr(n.$2(_y.$W),n.$2(_rw.$QO),n.$2(_y.$Do))});if(i.get_$1oV()){var r=this;n.$r(_im.$16d).$2a(IPresenceManager).$1I().$t(function(){return new _im.$16d(n.$2(_im.$4s),n.$2(_im.$Ll),n.$2(_y.$Do))})}else{var u=this;n.$r(_im.$od).$2a(IPresenceManager).$1I().$t(function(){return new _im.$od(n.$2(_im.$4s),n.$2(_im.$Ll),n.$2(_y.$Do))})}var f=this;n.$r(IChatProviderFactory).$1I().$t(function(){return new _im.$zz(i.get_$A9()==="Mouse"&&!_a.$7Z.$z6(),n.$2(_im.$4s),n.$37(IPresenceManager),n.$37(IChatActionFactory),i.get_$A9())});var o=this;n.$r(_im.$rq).$1I().$t(function(){return new _im.$rq(i.get_$A9(),n.$2(_g.$O).get_$8N3(),n.$2(_im.$4s),n.$2(_im.$rr))});var e=this;n.$r(ILwxViewModel).$1I().$t(function(){return null})},$BjW:function(){return[new _a.$4Y(_im.$rq,2,1),new _a.$4Y(_im.$4s,2,1)]}};_im.$rq=function(n,t,i,r){if(n==="Mouse"&&t){var u=this;i.get_$9yQ().add_$21(function(n,t){if(!t.$3P)for(var i=0;i<t.$4C.length;i++){var u=t.$4C[i];r.$9Ch(u)}})}};_im.$Ey=function(n,t,i,r){this.$$d_$4S4=Function.createDelegate(this,this.$4S4);this.$$d_$Dd2=Function.createDelegate(this,this.$Dd2);this.$$d_$5F3=Function.createDelegate(this,this.$5F3);_im.$Ey.initializeBase(this);this.$Ro=r;this.$A2=n;this.$LA=new _C(this.$$d_$5F3,_a.$0.$6y);this.set_$3SU(i.$1CJ(1,_bc.$6Z.$11Y,this.$A2.get_$g0(),1));this.$A2.get_$g0().add_$21(this.$$d_$Dd2);t.add_$Xh(this.$$d_$4S4);if(r.get_mainWindowInstance()&&!r.get_mainWindowInstance().closed){var u=this;_a.$3A.$Np(r.get_mainWindowInstance(),function(n){n.chatWindowReady(u.$A2.get_$a())})}};_im.$Ey.prototype={$Ro:null,$A2:null,$LA:null,$Vx:null,$6vg:null,get_$3SU:function(){return this.$w(_im.$Ey.$6re)},set_$3SU:function(n){this.$P(_im.$Ey.$6re,n);return n},get_$4Cq:function(){return this.$w(_im.$Ey.$735)},set_$4Cq:function(n){this.$P(_im.$Ey.$735,n);return n},set_$dk:function(n){this.$6vg=n;this.$4("RawEditorContent");return n},$Dd2:function(n,t){switch(t.$3P){case 0:for(var r=0;r<t.$4C.length;r++){var f=t.$4C[r];this.get_$3SU().$30b(f)}return;case 2:for(var i=t.$4W.length-1;i>=0;i--){var e=t.$4W[i];var o=this;var u=this.get_$3SU().get_$9S().$HC(function(n){var t=n;return t.$I2.get_$DF()===e.get_$DF()});u<this.get_$3SU().get_$9S().get_$A()&&this.get_$3SU().get_$9S().$5W(u)}return}},$5F3:function(){if(!_js.$9.$o(this.get_$4Cq())){this.$A2.$EcS(this.get_$4Cq());var n=this;_a.$3A.$Np(this.$Ro.get_mainWindowInstance(),function(t){t.sendChatMessage(n.$A2.get_$2P().Id,n.get_$4Cq())})}},$4S4:function(n){_js.Trace.logInfo(_a.$0.$6y,"ChatViewModel.BeforeUnload invoked.");this.$A2.get_$g0().remove_$21(this.$$d_$Dd2);var t=this;_a.$3A.$Np(this.$Ro.get_mainWindowInstance(),function(n){_js.Trace.logInfo(_a.$0.$6y,"ChatViewModel.BeforeUnload calling into main window.");n.endChat(t.$A2.get_$a())})}};_im.$rr=function(n,t,i){this.$I=n;this.$9J=t;this.$Ro=i};_im.$rr.prototype={$I:null,$9J:null,$Ro:null,$9Ch:function(n){var r={};r.ItemID=n.get_$y();var i=new _y.$Ex;i.set_$6y(n);var t=_bc.$2I.get_$C1o();if(n.$5gI!==-1&&n.$5gN!==-1){t.$5gH=n.$5gI;t.$5gM=n.$5gN}_js.Trace.logInfo(_a.$0.$6y,"ChatViewModelFactory: Chat.BodyText: {0}",n.get_$2dk());var u=this;this.$I.$VG(IChatViewModelFactory,function(){return u},r,t,i,!1)},$wU:function(n,t,i){return null},$1CI:function(n,t,i){var u=n.get_$6y();return new _im.$Ey(u,this.$I,this.$9J,this.$Ro)}};_im.$1Qp=function(n){this.$Ro=n};_im.$1Qp.prototype={$Ro:null,$9mB:function(n,t,i){for(var f=new Array(n.get_$A()),e=new Array(n.get_$A()),r=0;r<n.get_$A();r++){var u=n.get_$E(r);f[r]=u.get_$29();e[r]=u.get_$DF()}var o=$C(t)?null:t.get_$a();var s=this;_a.$3A.$Np(this.$Ro.get_mainWindowInstance(),function(n){n.startChat(f,e,o,i)})}};_im.$Qa=function(n){this.$$d_$47W=Function.createDelegate(this,this.$47W);this.$$d_$DZs=Function.createDelegate(this,this.$DZs);this.$$d_$E8G=Function.createDelegate(this,this.$E8G);this.$$d_$ADB=Function.createDelegate(this,this.$ADB);this.$$d_$DnO=Function.createDelegate(this,this.$DnO);_im.$Qa.initializeBase(this,[n]);_im.$Qa.$6Mx++;this.$4cf=".ChatMouseView#Handler."+_im.$Qa.$6Mx};_im.$Qa.prototype={$4cf:null,$4b:null,$NF:null,$38a:null,$A2:null,$Bu9:function(){if(!this.$A2)return null;if(!_js.$9.$o(this.$A2.get_$3n()))return this.$A2.get_$3n();var t=this.$A2.get_$g0();var n=t.get_$A();if(n)if(n===1){var i=t.get_$E(0);return String.format(_nbs.NonBootStrings.l_ChatSubjectOneParticipant_Text,i.get_$29())}else return String.format(_nbs.NonBootStrings.l_ChatSubjectMultipleParticipants_Text,n);else return null},$3R:function(){_js.$7.prototype.$3R.call(this);this.$38a.$3Q();this.$4b.$1XD(100);this.$47W(null)},$8g:function(){_js.$F.prototype.$8g.call(this);if(!this.get_$k()){if(this.$A2){this.$A2.get_$g0().remove_$21(this.$$d_$DnO);this.$A2.$1B(_h.$1g.$qA.$3C,this.$$d_$ADB)}this.$A2=null;return}var n=this.get_$k();this.$A2=n.$A2;this.$A2.get_$g0().add_$21(this.$$d_$DnO);this.$A2.$p(_h.$1g.$qA.$3C,this.$$d_$ADB);this.$A2.$p(_h.$1g.$4Cx.$3C,this.$$d_$E8G)},$4Q:function(){_js.$7.prototype.$4Q.call(this);if(!this.$u){this.$NF.$1B(_b.$4B.$3u2.$3C,this.$$d_$DZs);$(window).unbind(this.$4cf);this.$NF=null;this.$4b=null;this.$38a=null;return}this.$4b=this.$u.$1N("TranscriptScrollRegion");this.$NF=this.$u.$1N("TranscriptLabel");this.$38a=this.$u.$1N("Editor");this.$NF.$p(_b.$4B.$3u2.$3C,this.$$d_$DZs);$(window).bind("resize"+this.$4cf,this.$$d_$47W);this.$7C3();this.$38a.$EYB()},$7C3:function(){var n=this.$Bu9();_js.$9.$o(n)||(window.document.title=n)},$DnO:function(n,t){this.$7C3()},$ADB:function(n,t){this.$7C3()},$E8G:function(n,t){if(this.$A2.get_$4Cw()){var i=this.$38a.get_$S().children("textarea");i.length>0&&i[0].setAttribute("disabled","true")}},$DZs:function(n,t){var i=this.$4b.get_$S();var r=i.prop("scrollHeight");i.scrollTop(r-i.height())},$47W:function(n){var t=$(window).height();t>=425&&this.$4b.get_$S().height(251+t-425)}};_im._TI=function(){};_im._TI.$$cctor=function(){var n="ChatMouseView";new _A(n,function(){_im._TI.$1[n]===undefined&&(_im._TI.$1[n]=[null,[[-1,0,["ParticipantsViewModel"],[_im._TI.$CjW],null,"DataContext",null,_im._TI.$Y,1,null,null,null]],null,[[-1,0,["Chat","BodyText"],[_im._TI.$56N,_im._TI.$CgY],null,"Html",null,_im._TI.$Ix,1,null,null,null]],[[-1,0,["Chat","LastMessageAriaLabel"],[_im._TI.$56N,_im._TI.$8m7],null,"Text",null,_im._TI.$2oh,1,null,null,null],[-1,0,["Chat","LastMessageAriaLabel"],[_im._TI.$56N,_im._TI.$8m7],null,"AriaLabel",null,_im._TI.$1m,1,null,null,null]],[[-1,0,["Chat","Status"],[_im._TI.$56N,_im._TI.$CgZ],null,"Html",null,_im._TI.$Ix,1,null,null,null]],[[-1,4,null,null,null,"EditorAriaLabel",null,_im._TI.$1pj,0,null,null,null,_u.Strings.l_IM_AT_Textbox_Text],[-1,0,["SendCommand"],[_im._TI.$CjY],null,"EnterCommand",null,_im._TI.$Ccv,1,null,null,null],[-1,0,["GetEditorContentCommand"],[_im._TI.$CjV],_im._TI.$Cja,"GetContentCommand",_im._TI.$2Qk,_im._TI.$2Qm,2,null,null,null],[-1,0,["SendText"],[_im._TI.$CjZ],_im._TI.$Cjc,"Content",_im._TI.$55J,_im._TI.$55K,2,null,null,null],[-1,0,["RawEditorContent"],[_im._TI.$CjX],_im._TI.$Cjb,"RawContent",_im._TI.$Ccu,_im._TI.$55L,2,null,null,null]]]);var t=_im._TI._hf.childNodes[0].cloneNode(!0);var i=new _z.$CR(_B.$3(t,[0,3]),_js.$2.Instance.$2(_y.$W),_js.$2.Instance.$2(_a.$t),_js.$2.Instance.$2(_ff.$M));i.set_$1z5("_im_8 ms-font-weight-regular ms-font-color-black");i.set_$3Hi(!1);i.set_$Ald(!0);var o=new _b.$4B(_B.$3(t,[0,2,0]));var s=new _b.$OO(_B.$3(t,[0,1,1]),_js.$2.Instance.$2(_ff.$M));var r=new _b.$4B(_B.$3(t,[0,1,0]));var f=new _fce.$1F(_B.$3(t,[0,1]),_js.$2.Instance.$2(_js.$p),_js.$2.Instance.$2(_ff.$C),_js.$2.Instance.$2(_ff.$M));var u=new _js.$7(_B.$3(t,[0,0,0,0]));u.set_$6("ReadOnlyRecipientWellView");var e=new _fce.$1F(_B.$3(t,[0,0,0]),_js.$2.Instance.$2(_js.$p),_js.$2.Instance.$2(_ff.$C),_js.$2.Instance.$2(_ff.$M));return new _B(t,[e,u,f,r,s,o,i]).R({TranscriptScrollRegion:f,TranscriptLabel:r,Editor:i})},_im.$Ey,_im.$Qa,!1,!1,!1,0,_im._TI.$1)};_im._TI.$9V=function(){var n=window.document.createElement("DIV");n.innerHTML="<div> <div class='_im_2'> <div class='_im_3 ms-bg-color-neutralLighter'> <div class='_im_4'> <div></div> </div> </div> <div class='_im_5'> <span></span> <div></div> </div> <div class='_im_6 ms-font-weight-regular ms-font-color-neutralSecondary ms-bg-color-neutralLighter ms-border-color-neutralTertiaryAlt'> <span></span> </div> <div class='_im_7 border-color-transparent ms-border-color-neutralTertiaryAlt-hover'></div> </div> </div>";_js.$F.get_$9N().appendChild(n);return n};_im._TI.$CjW=function(n){return n.get_$3SU()};_im._TI.$56N=function(n){return n.$A2};_im._TI.$CgY=function(n){return n.get_$2dk()};_im._TI.$8m7=function(n){return n.get_$8Y8()};_im._TI.$CgZ=function(n){return n.get_$GX()};_im._TI.$CjY=function(n){return n.$LA};_im._TI.$CjV=function(n){return n.$Vx};_im._TI.$2Qk=function(n){return n.$1Sw};_im._TI.$CjZ=function(n){return n.get_$4Cq()};_im._TI.$55J=function(n){return n.get_$DX()};_im._TI.$CjX=function(n){return n.$6vg};_im._TI.$Ccu=function(n){return n.get_$ma()};_im._TI.$Y=function(n,t){n.set_$k(t)};_im._TI.$Ix=function(n,t){n.set_$SU(t)};_im._TI.$2oh=function(n,t){n.set_$1K(t)};_im._TI.$1m=function(n,t){n.set_$4E(t)};_im._TI.$Ccv=function(n,t){n.set_$Qd(t)};_im._TI.$Cja=function(n,t){n.$Vx=t};_im._TI.$2Qm=function(n,t){n.set_$4mW(t)};_im._TI.$Cjc=function(n,t){n.set_$4Cq(t)};_im._TI.$55K=function(n,t){n.set_$DX(t)};_im._TI.$Cjb=function(n,t){n.set_$dk(t)};_im._TI.$55L=function(n,t){n.set_$ma(t)};_im._TI.$1pj=function(n,t){n.$2H5=t};_im.$19t.registerClass("_im.$19t",_h.$19q.$$(Number));_im.$zv.registerClass("_im.$zv",null,IChatActionFactory);_im.$1EQ.registerClass("_im.$1EQ",_h.$19q.$$(Boolean));_im.$1ER.registerClass("_im.$1ER");_im.$1H8.registerClass("_im.$1H8",_h.$19q.$$(Number));_im.$1JB.registerClass("_im.$1JB",_h.$19q.$$(Number));_im.$13T.registerClass("_im.$13T",_h.$19q.$$(Number));_im.$1Oo.registerClass("_im.$1Oo",_h.$19q.$$(Number));_im.$1PM.registerClass("_im.$1PM",_h.$19q.$$(Number));_im.$1QA.registerClass("_im.$1QA",_h.$19q.$$(Number));_im.$Xw.registerClass("_im.$Xw",_a.$Fj);_im.$18V.registerClass("_im.$18V");_im.$1Qx.registerClass("_im.$1Qx",_h.$19q.$$(Number));_im.$1T5.registerClass("_im.$1T5",_h.$19q.$$(Number));_im.$1CB.registerClass("_im.$1CB");_im.$4s.registerClass("_im.$4s",_js.$Eb,IChatManager,_js.$13h);_im.$zw.registerClass("_im.$zw",null,IChatManagerFactory);_im.$Ll.registerClass("_im.$Ll",_js.$Eb);_im.$zx.registerClass("_im.$zx",_js.$Eb);_im.$zy.registerClass("_im.$zy",null,IChatProvider);_im.$zz.registerClass("_im.$zz",null,IChatProviderFactory);_im.$od.registerClass("_im.$od",_js.$1ZS,IPresenceManager);_im.$16d.registerClass("_im.$16d",_im.$od);_im.$SI.registerClass("_im.$SI",_js.$1ZS);_im.$1Nn.registerClass("_im.$1Nn",_im.$SI);_im.$1Nx.registerClass("_im.$1Nx");_im.$oe.registerClass("_im.$oe");_im.$4h.registerClass("_im.$4h");IMComponent.registerClass("IMComponent",null,_a.$1XU);_im.$rq.registerClass("_im.$rq");_im.$Ey.registerClass("_im.$Ey",_a.$Em);_im.$rr.registerClass("_im.$rr",null,IChatViewModelFactory,_bc.$1JX);_im.$1Qp.registerClass("_im.$1Qp",null,_h.$141);_im.$Qa.registerClass("_im.$Qa",_js.$7);_im._TI.registerClass("_im._TI");_im.$4s.$2Ys="SignInState";_im.$4s.$4xj="IsSignedIn";_im.$4s.$27Z="Presence";_im.$SI.$7Is=5e3;_im.$Ey.$735=new _H("SendText",String,_im.$Ey,"");_im.$Ey.$6re=new _H("ParticipantsViewModel",_rw.$4c,_im.$Ey);_im.$Qa.$6Mx=0;_im._TI._hf=_im._TI.$9V();_im._TI.$1={};_im._TI.$$cctor();
window.scriptsLoaded['microsoft.exchange.clients.owa2.client.core.im.js'] = 1; window.scriptProcessEnd = window.scriptProcessEnd || {}; window.scriptProcessEnd['microsoft.exchange.clients.owa2.client.core.im.js'] = (new Date()).getTime(); } catch(e) { window.owaLastErrorReported = e; throw e; }
